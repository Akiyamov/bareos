If you are like me, you want to get Bareos running immediately to get a feel
for it, then later you want to go back and read about all the details. This
chapter attempts to accomplish just that: get you going quickly without all
the details.

Bareos comes prepackaged for a number of Linux distributions.
So the easiest way to get to a running Bareos installation, 
is to use a platform where prepacked Bareos packages are available.
Additional information can be found in the chapter \ilink{Operating Systems}{SupportedOSes}.

%\TODO{If you are using a platform, for which Bareos is not available in a prepackaged format,
%please refer to the \ilink{Building chapter}{compile}.}

If Bareos is available as a package, 
only 4 steps are required to get to a running Bareos System:
\begin{itemize}
    \item Subscribe to the repository according to your platform and version
    \item Install the Bareos package
    \item Prepare database backend
    \item Start the daemons
\end{itemize}

This will start a very basic Bareos installation which will regularly backup a directory to disk.
In order to fit it to your needs, you'll have to adapt the configuration and might want to backup other clients.

\section{Subscribe to a Software Repository and Install Software}

You'll find Bareos binary package repositories at \url{http://download.bareos.org/bareos}.
Add the repository to your system. 
You will find the public key in the repodata subdirectory 
(for Debian the distribution directory itself). 
See your distribution's documentation for details.
 
You will then have to install the package bareos. 

This will install all client- and server components and the postgresql backend. 
We recommend to use postgresql, therefore this is the default. 
You can also use mysql or sqlite3 
(where sqlite3 is intended for testing purposes only, by no means recommended for productive use).

If you want to use mysql rather than postgresql, you need two packages: bareos and bareos-database-mysql.

Here are some working examples:

\subsection{Install on RedHat based Linux Distributions}
\subsubsection{RHEL 6}

For adding the repository:
\begin{commands}{Add Bareos repository}
wget -O /etc/yum.repos.d/bareos.repo http://download.bareos.org/bareos/release/latest/RHEL_6/bareos.repo
\end{commands}

For using PostgreSQL backend:
\begin{commands}{Bareos installation on RHEL 6 (PostgreSQL backend)}
yum install bareos bareos-database-postgresql
\end{commands}

For using MySQL backend:
\begin{commands}{Bareos installation on RHEL 6 (MySQL backend)}
yum install bareos bareos-database-mysql
\end{commands}

\subsubsection{CentOS 6}

Just replace RHEL by CentOS in the repository URL

\subsubsection{RHEL 5}

yum in RHEL 5 has slightly different behaviour as far as dependency resolving is concerned: it sometimes install a dependent package after the one that has the dependency defined. To make sure that it works, install the desired Bareos database backend package first in a separate step:

First add the repository using:
\begin{commands}{Add Bareos repository}
wget -O /etc/yum.repos.d/bareos.repo http://download.bareos.org/bareos/release/latest/RHEL_5/bareos.repo
\end{commands}

After that you can install with PostgreSQL backend:
\begin{commands}{Bareos installation on RHEL 5 (PostgreSQL backend)}
yum install bareos-database-postgresql
yum install bareos
\end{commands}

Or install with MySQL backend:
\begin{commands}{Bareos installation on RHEL 5 (MySQL backend)}
yum install bareos-database-mysql
yum install bareos
\end{commands}

\subsubsection{CentOS 5}

Again, just replace RHEL with CentOS in the repository URL.

\subsubsection{Fedora 18}

For adding the repository:
\begin{commands}{Add Bareos repository}
wget -O /etc/yum.repos.d/bareos.repo http://download.bareos.org/bareos/release/latest/Fedora_18/bareos.repo
\end{commands}

After that you can install with PostgreSQL backend:
\begin{commands}{Bareos installation on Fedora 18 (PostgreSql backend)}
yum install bareos bareos-database-postgresql
\end{commands}

Or install with MySQL backend:
\begin{commands}{Bareos installation on Fedora 18 (MySQL backend)}
yum install bareos bareos-database-mysql
\end{commands}

\subsection{Install on SUSE based Linux Distributions}

\subsubsection{SLES11 SP3}

\begin{commands}{Bareos installation on SUSE Linux Enterprise Server (SLES) 11 SP3}
zypper addrepo --refresh http://download.bareos.org/bareos/release/latest/SLE_11_SP3/bareos.repo
zypper install bareos bareos-database-mysql
\end{commands}
In this example using mysql as database backend.

\subsubsection{openSUSE 13.1}

\begin{commands}{Bareos installation on openSUSE 13.1}
zypper addrepo --refresh http://download.bareos.org/bareos/release/latest/openSUSE_13.1/bareos.repo
zypper install bareos bareos-database-mysql
\end{commands}


\subsection{Install on Debian based Linux Distributions}


\subsubsection{Debian 7}

\begin{commands}{Bareos installation on Debian 7}
URL=http://download.bareos.org/bareos/release/latest/Debian_7.0/
printf "deb $URL /\n" > /etc/apt/sources.list.d/bareos.list

# add package key
wget -q $URL/Release.key -O- | apt-key add -

apt-get update
apt-get install bareos bareos-database-postgresql
\end{commands}

\subsubsection{Ubuntu 12.04}

\begin{commands}{Bareos installation on Ubuntu 12.04}
URL=http://download.bareos.org/bareos/release/latest/xUbuntu_12.04/
printf "deb $URL /\n" > /etc/apt/sources.list.d/bareos.list

# add package key
wget -q $URL/Release.key -O- | apt-key add -

apt-get update
apt-get install bareos bareos-database-postgresql
\end{commands}

\section{Prepare Bareos database}
    \label{CreateDatabase}

We assume that you have already your database installed and basically running.
Currently the database backend PostgreSQL and MySQL are recommended. The Sqlite database backend is only intended for testing purposes.

The easiest way to set up a database is using an system account that have passwordless local access to the database. 
Often this is the user \user{root} for MySQL and the user \user{postgres} for PostgreSQL.

For details, see chapter \ilink{Catalog Maitenance}{CatMaintenanceChapter}.

\subsection{PostgreSQL}
If your are using PostgreSQL and your PostgreSQL administration user is \user{postgres} (default), use following commands:

\begin{commands}{Setup Bareos catalog database}
su postgres -c /usr/lib/bareos/scripts/create_bareos_database
su postgres -c /usr/lib/bareos/scripts/make_bareos_tables
su postgres -c /usr/lib/bareos/scripts/grant_bareos_privileges
\end{commands}


\subsection{MySQL}
Make sure, that \user{root} has direct access to the local MySQL server. 
Check if the command \command{mysql} connects to the database without defining the password.
This is the default on RedHat and SUSE distributions. 
On other systems (Debian, Ubuntu),
create the file \file{~/.my.cnf} with your authentication informations:

\begin{config}{MySQL credentials file .my.cnf}
[client]
host=localhost
user=root
password=<input>YourPasswordForAccessingMysqlAsRoot</input>
\end{config}

Setup the Bareos database tables by following commands:
\begin{commands}{Setup Bareos catalog database}
/usr/lib/bareos/scripts/create_bareos_database
/usr/lib/bareos/scripts/make_bareos_tables
/usr/lib/bareos/scripts/grant_bareos_privileges
\end{commands}

As some Bareos updates also require a database schema update,
the file \file{/root/.my.cnf} might also be useful in the future.


\section{Start the daemons}
\begin{commands}{Start the Bareos Daemons}
service bareos-dir start
service bareos-sd start
service bareos-fd start
\end{commands}

You will eventually have to allow access to the ports 9101-9103, used by Bareos.

Now you should be able to access the director using the bconsole.

\chapter{Updating Bareos}
\label{bareos-update}

In most cases, a Bareos update is simply done by a package update of the distribution.
Please remind, that Bareos Director and Bareos Storage Daemon must always have the same version.
The version of the File Daemon may differ, see chapter about \ilink{backward compatibility}{backward-compability}.

\section{Updating the database schema}

Sometimes improvements in Bareos make it neccessary to update the database scheme.
This has to be done as database administrator and can therefore not be done by the Bareos packages itself, even if the database host runs on the same system as the Bareos Director.

\warning{If the Bareos catalog database has not the current schema, the Bareos Director refuses to start.}
Detailed information can than be found in the log file \logfileUnix.

Take a look in the \ilink{Release Notes}{releasenotes} to see, what Bareos updates to require a database schema update.

The task of updating the database schema is done by the script
\command{/usr/lib/bareos/scripts/update_bareos_tables}.

However, this script requires administration access to the database.
Depending on your distribution and your database, this requires different preparations.
More details can be found in chapter \ilink{Catalog Maitenance}{CatMaintenanceChapter}.

\warning{If you had configured the Bareos database during install using Bareos environment variables (\variable{db_name}, \variable{db_user} or \variable{db_password}, see \ilink{Catalog Maitenance}{CatMaintenanceChapter}), make sure to have these variables definied in the same way when calling the update and grant scripts.}

\subsection{PostgreSQL}
If your are using PostgreSQL and your PostgreSQL administrator is \user{postgres} (default), use following commands:

\begin{commands}{Update PostgreSQL database schema}
su postgres -c /usr/lib/bareos/scripts/update_bareos_tables
su postgres -c /usr/lib/bareos/scripts/grant_bareos_privileges
\end{commands}

The \command{grant_bareos_privileges} command is required, if new databases tables are introduced. It does not hurt to run es multiple times.

After this, restart the Bareos Director and verify it starts without problems.

\subsection{MySQL}
Make sure, that \user{root} has direct access to the local MySQL server.
Check if the command \command{mysql} without parameter connects to the database.
If not, you may be required to adapt your local MySQL config file \file{~/.my.cnf}.
It should look similar to this:

\begin{config}{MySQL credentials file .my.cnf}
[client]
host=localhost
user=root
password=<input>YourPasswordForAccessingMysqlAsRoot</input>
\end{config}

If you are able to connect via the \command{mysql} to the database, run the following script from the Unix prompt:
\begin{commands}{Update MySQL database schema}
/usr/lib/bareos/scripts/update_bareos_tables
\end{commands}

Currently on MySQL is it not neccessary to run \command{grant_bareos_privileges}, because access to the database is already given using wildcards.

After this, restart the Bareos Director and verify it starts without problems.
