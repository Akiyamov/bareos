%%
%%

This chapter addresses the installation process of the \bareosWebui.

Since \sinceVersion{dir}{bareos-webui}{15.2.0} bareos-webui is part of the Bareos project and available for a number of platforms.

\begin{center}
  \includegraphics[width=0.8\textwidth]{\idir bareos-webui-jobs}
\end{center}

\section{System Requirements}

\begin{itemize}
\item A platform, for which the \package{bareos-webui} package is available, see \nameref{sec:BareosPackages}.
\item A working Bareos environment.
\item \bareosDir version $>=$ \bareosWebui version.
\item The \bareosWebui can be installed on any host. It does not have to be installed on the same as the \bareosDir.
\item The default installation uses an Apache 2.x webserver with mod-rewrite, mod-php5 and mod-setenv.
\item PHP $>$= 5.3.3
\end{itemize}

\subsection{Version $<$ 16.2}

\bareosWebui \sinceVersion{}{bareos-webui incorporates Zend Framework 2}{16.2.4} incorporates the required Zend Framework 2 components, no extra Zend Framework installation is required.
For older versions of \package{bareos-webui}, you must install Zend Framework separately.
Unfortunately, not all distributions offer Zend Framework 2 packages.
The following list shows where to get the Zend Framework 2 package:

\begin{itemize}
  \item RHEL, CentOS
    \begin{itemize}
    \item \url{https://fedoraproject.org/wiki/EPEL}
    \item \url{https://apps.fedoraproject.org/packages/php-ZendFramework2}
    \end{itemize}

  \item Fedora
    \begin{itemize}
    \item \url{https://apps.fedoraproject.org/packages/php-ZendFramework2}
    \end{itemize}

  \item SUSE, Debian, Ubuntu
    \begin{itemize}
    \item \url{http://download.bareos.org/bareos}
    \end{itemize}
\end{itemize}

Also be aware, that older versions of \bareosDir do not support the \nameref{sec:SubdirectoryConfigurationScheme}
and therefore Bareos configuration resource files must be included manually.

\section{Installation}

\subsection{Adding the Bareos Repository}

If not already done, add the Bareos repository that is matching your Linux distribution. Please have a look at the chapter \nameref{sec:InstallBareosPackages} for more information on how to achieve this.

\subsection{Install the bareos-webui package}

After adding the repository simply install the bareos-webui package via your package manager.

\begin{itemize}
 \item RHEL, CentOS and Fedora
\begin{commands}{}
yum install bareos-webui
\end{commands}
 or
\begin{commands}{}
dnf install bareos-webui
\end{commands}
\end{itemize}

\begin{itemize}
 \item SUSE Linux Enterprise Server (SLES), openSUSE
\begin{commands}{}
zypper install bareos-webui
\end{commands}
\end{itemize}

\begin{itemize}
 \item Debian, Ubuntu
\begin{commands}{}
apt-get install bareos-webui
\end{commands}
\end{itemize}

\subsection{Minimal Configuration}

This assumes, \bareosDir and \bareosWebui are installed on the same host.

\begin{enumerate}
    \item If you are using SELinux, allow HTTPD scripts and modules make network connections:
\begin{commands}{}
setsebool -P httpd_can_network_connect on
\end{commands}
    For details, see \nameref{sec:webui-selinux}.
    \item restart Apache (to load configuration provided by bareos-webui, see \nameref{sec:webui-apache})
    \item Use \command{bconsole} to create a user with name \name{admin} and password \name{secret} and permissions defined in \resourcename{Dir}{Profile}{webui-admin}:
\begin{bconsole}{add a named console}
*<input>configure add console name=admin password=secret profile=webui-admin</input>
\end{bconsole}
    Of course, you can choose other names and passwords.
    For details, see \nameref{sec:webui-console}.
    \item Login to http://HOSTNAME/bareos-webui
\end{enumerate}


\subsection{Configuration Details}


\subsubsection{Create a restricted consoles}
    \label{sec:webui-console}

There is not need, that \bareosWebui itself provide a user management.
Instead it uses so named \resourcetype{Dir}{Console} defined in the \bareosDir.
You can have multiple consoles with different names and passwords, sort of like multiple users, each with different privileges.

At least one \resourcetype{Dir}{Console} is required to use the \bareosWebui.

To allow a user with name \name{admin} and password \name{secret} to access the \bareosDir
with permissions defined in the \resourcename{Dir}{Profile}{webui-admin} (see \nameref{sec:webui-profile}),
either
\begin{itemize}
\item create a file \file{/etc/bareos/bareos-dir.d/console/admin.conf} with following content:
\begin{bareosConfigResource}{bareos-dir}{console}{admin}
Console {
  Name = "admin"
  Password = "secret"
  Profile = "webui-admin"
}
\end{bareosConfigResource}

To enable this, reload or restart your \bareosDir.
\item or use the \command{bconsole}:
\begin{bconsole}{add console}
*<input>configure add console name=admin password=secret profile=webui-admin</input>
\end{bconsole}
\end{itemize}


For details, please read \nameref{DirectorResourceConsole}.



\subsubsection{Configuration of profile resources}
    \label{sec:webui-profile}

The package \package{bareos-webui} comes with a predefined profile for \bareosWebui: \resourcename{Dir}{Profile}{webui-admin}.

If your \bareosWebui is installed on another system then the \bareosDir, you have to copy the profile to the \bareosDir.

This is the default profile, giving access to all Bareos resources and allowing all commands used by the \bareosWebui:

\begin{bareosConfigResource}{bareos-dir}{profile}{webui-admin}
Profile {
  Name = webui-admin
  CommandACL = !.bvfs_clear_cache, !.exit, !.sql, !configure, !create, !delete, !purge, !sqlquery, !umount, !unmount, *all*
  Job ACL = *all*
  Schedule ACL = *all*
  Catalog ACL = *all*
  Pool ACL = *all*
  Storage ACL = *all*
  Client ACL = *all*
  FileSet ACL = *all*
  Where ACL = *all*
  Plugin Options ACL = *all*
}
\end{bareosConfigResource}

The \resourcetype{Dir}{Profile} itself does not give any access to the \bareosDir,
but can be used by \resourcetype{Dir}{Console}, which do give access to the \bareosDir, see \nameref{sec:webui-console}.

For details, please read \nameref{DirectorResourceProfile}.

\subsubsection{SELinux}
\label{sec:webui-selinux}
\index[general]{SELinux!bareos-webui}

To use \bareosDir on a system with SELinux enabled,
permission must be given to HTTPD to make network connections:
\begin{commands}{}
setsebool -P httpd_can_network_connect on
\end{commands}


\subsubsection{Configure your Apache Webserver}
\index[general]{Apache!bareos-webui}
\label{sec:webui-apache}

The package \package{bareos-webui} provides a default configuration for Apache.
Depending on your distribution, it is installed at \file{/etc/apache2/conf.d/bareos-webui.conf}, \file{/etc/httpd/conf.d/bareos-webui.conf} or \file{/etc/apache2/available-conf/bareos-webui.conf}.

The required Apache modules, \argument{setenv}, \argument{rewrite} and \argument{php} are enabled via package postinstall script.
However, after installing the \package{bareos-weui} package, you need to restart your Apache webserver manually.

\subsubsection{Configure your /etc/bareos-webui/directors.ini}
\index[general]{Configuration!WebUI}

Configure your directors in \file{/etc/bareos-webui/directors.ini} to match your settings.

The configuration file \file{/etc/bareos-webui/directors.ini} should look similar to this:

\begin{bconfig}{/etc/bareos-webui/directors.ini}
;
; Bareos WebUI Configuration
; File: /etc/bareos-webui/directors.ini
;

;
; Section bareos-dir
;
[bareos-dir]

; Enable or disable director. Possible values are "yes" or "no", the default is "yes".
enabled = "yes"

; Fill in the IP-Address or FQDN of your director.
diraddress = "localhost"

; Default value is 9101
dirport = 9101

; Set catalog to explicit value if you have multiple catalogs,
; the default value is "MyCatalog".
;catalog = "MyCatalog"

;
; Section remote-dir
;
[remote-dir]
enabled = "no"
diraddress = "hostname"
;dirport = 9101
;catalog = "MyCatalog"
;tls_verify_peer = false
;server_can_do_tls = false
;server_requires_tls = false
;client_can_do_tls = false
;client_requires_tls = false
;ca_file = ""
;cert_file = ""
;cert_file_passphrase = ""
;allowed_cns = ""
\end{bconfig}

You can add as many directors as you want, also the same host with a different name and different catalog, if you have multiple catalogs.

\subsubsection{Configure your /etc/bareos-webui/configuration.ini}

Since 16.2 you are able to configure a few parameters of the webui to your needs.

\begin{bconfig}{/etc/bareos-webui/configuration.ini}
[session]
# Default: 3600 seconds
timeout=3600

[tables]
# Define a list of pagination values.
# Default: 10,25,50,100
pagination_values=10,25,50,100

# Default number of rows per page
# for possible values see pagination_values
# Default: 25
pagination_default_value=25

# State saving - restore table state on page reload.
# Default: false
save_previous_state=false

[autochanger]
# Pooltype for label to use as filter.
# See pooltype in output of bconsole: list pools
# Default: none
labelpooltype=scratch
\end{bconfig}

\section{Additional information}

\subsection{NGINX}
\index[general]{nginx!bareos-webui}

If you prefer to use bareos-webui on Nginx with php5-fpm instead of Apache,
a basic working configuration could look like this:

\begin{bconfig}{bareos-webui on nginx}
server {

        listen       9100;
        server_name  bareos;
        root         /var/www/bareos-webui/public;

        location / {
                index index.php;
                try_files $uri $uri/ /index.php?$query_string;
        }

        location ~ .php$ {

                include snippets/fastcgi-php.conf;

                # With php5-cgi alone pass the PHP
                # scripts to FastCGI server
                # listening on 127.0.0.1:9000

                # fastcgi_pass 127.0.0.1:9000;

                # With php5-fpm:

                fastcgi_pass unix:/var/run/php5-fpm.sock;

                # Set APPLICATION_ENV to either 'production' or 'development'

                # fastcgi_param APPLICATION_ENV development;
                fastcgi_param APPLICATION_ENV production;

        }

}
\end{bconfig}
